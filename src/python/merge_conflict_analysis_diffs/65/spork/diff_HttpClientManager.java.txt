====1
1:18a
2:19,22c
3:19,22c
  import com.alibaba.nacos.common.http.client.ApacheAsyncHttpClientRequest;
  import com.alibaba.nacos.common.http.client.ApacheHttpClientRequest;
  import com.alibaba.nacos.common.http.client.NacosAsyncRestTemplate;
  import com.alibaba.nacos.common.http.client.NacosRestTemplate;
====3
1:19a
2:23a
3:24c
  import com.alibaba.nacos.common.utils.ExceptionUtil;
====3
1:25a
2:29a
3:31,32c
  import java.util.concurrent.atomic.AtomicBoolean;
  
====
1:45a
2:50,56c
  
  	private static final NacosRestTemplate NACOS_REST_TEMPLATE = new NacosRestTemplate(
  	    new ApacheHttpClientRequest(HttpClients.custom().setDefaultRequestConfig(DEFAULT_CONFIG).build()));
  
      private static final NacosAsyncRestTemplate NACOS_ASYNC_REST_TEMPLATE = new NacosAsyncRestTemplate(
          new ApacheAsyncHttpClientRequest(HttpAsyncClients.custom().setDefaultRequestConfig(DEFAULT_CONFIG).build()));
  
3:53,61c
    
    private static final NacosRestTemplate NACOS_REST_TEMPLATE = new NacosRestTemplate(
  	    new ApacheHttpClientRequest(HttpClients.custom().setDefaultRequestConfig(DEFAULT_CONFIG).build()));
  
    private static final NacosAsyncRestTemplate NACOS_ASYNC_REST_TEMPLATE = new NacosAsyncRestTemplate(
          new ApacheAsyncHttpClientRequest(HttpAsyncClients.custom().setDefaultRequestConfig(DEFAULT_CONFIG).build()));
    
  	private static final AtomicBoolean alreadyShutdown = new AtomicBoolean(false);
  
====
1:51,58c
  				logger.warn("[HttpClientManager] Start destroying HttpClient");
  				try {
  					SYNC_HTTP_CLIENT.close();
  					ASYNC_HTTP_CLIENT.close();
  				}
  				catch (Exception ignore) {
  				}
  				logger.warn("[HttpClientManager] Destruction of the end");
2:62,71c
  				logger.warn("[HttpClientManager] Start destroying HttpClient");
  				try {
  					SYNC_HTTP_CLIENT.close();
  					ASYNC_HTTP_CLIENT.close();
                      NACOS_REST_TEMPLATE.close();
                      NACOS_ASYNC_REST_TEMPLATE.close();
  				}
  				catch (Exception ignore) {
  				}
  				logger.warn("[HttpClientManager] Destruction of the end");
3:67c
  				shutdown();
====
1:71a
2:85,92c
  	public static NacosRestTemplate getNacosRestTemplate() {
  	    return NACOS_REST_TEMPLATE;
      }
  
      public static NacosAsyncRestTemplate getNacosAsyncRestTemplate() {
  	    return NACOS_ASYNC_REST_TEMPLATE;
      }
  
3:81,107c
  	public static NacosRestTemplate getNacosRestTemplate() {
  	    return NACOS_REST_TEMPLATE;
    }
  
    public static NacosAsyncRestTemplate getNacosAsyncRestTemplate() {
  	    return NACOS_ASYNC_REST_TEMPLATE;
    }
  
  	public static void shutdown() {
  		if (!alreadyShutdown.compareAndSet(false, true)) {
  			return;
  		}
  		logger.warn("[HttpClientManager] Start destroying HttpClient");
  		try {
  			SYNC_HTTP_CLIENT.close();
  			ASYNC_HTTP_CLIENT.close();
        NACOS_REST_TEMPLATE.close();
        NACOS_ASYNC_REST_TEMPLATE.close();
  		}
  		catch (Exception ex) {
  			logger.error("An exception occurred when the HTTP client was closed : {}",
  					ExceptionUtil.getStackTrace(ex));
  		}
  		logger.warn("[HttpClientManager] Destruction of the end");
  	}
  
  
